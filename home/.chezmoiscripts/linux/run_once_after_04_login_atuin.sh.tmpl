#!/usr/bin/env bash

# shellcheck disable=SC1091
source "${CHEZMOI_SOURCE_DIR:?env variable missing. Please only run this script via chezmoi}/.chezmoiscripts/linux/helpers/.00_helpers"

# =============================================================================
# Initialize Environment
# =============================================================================
common_init

{{- if eq .chezmoi.username "vantesh" }}

if [[ "$(atuin status)" == *"You are not logged in to a sync server"* ]]; then
print_box "smslant" "Atuin Login"
print_step "Logging in to Atuin"
atuin login \
 --username '{{ (rbw "Atuin").data.username }}' \
 --password '{{ (rbw "Atuin").data.password }}' \
 --key '{{ (rbwFields "Atuin").atuin_key.value }}'

atuin sync
else
print_info "Atuin is already logged in. Skipping login step."
print_info "Syncing Atuin..."
atuin sync
fi
{{- end }}
