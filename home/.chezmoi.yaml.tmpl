{{- /* Default to non-personal setup */ -}}
{{- $personal := false -}}

{{- /* Allow skipping prompts entirely (for CI or automated setups) */ -}}
{{- $skipPrompts := eq (env "NOCONFIRM") "1" -}}

{{- if not $skipPrompts -}}
  {{- writeToStdout "WARN: Please do no select 'y' or some scripts will fail!\n" -}}
  {{- writeToStdout "\n" -}}
  {{- $personal = promptBool "Is this a personal setup (y/N)" false -}}
{{- end -}}

{{- $osRelease := .chezmoi.osRelease -}}
{{- $distro_family := .chezmoi.os -}}
{{- if $osRelease -}}
  {{- $distro_family = default $distro_family (or (index $osRelease "idLike") (index $osRelease "id_like") (index $osRelease "id")) -}}
{{- end -}}

{{- if and (ne $distro_family "") (not (or (contains $distro_family "arch") (contains $distro_family "fedora") (contains $distro_family "rhel"))) -}}
  {{- if lookPath "pacman" -}}
    {{- $distro_family = "arch" -}}
  {{- else if lookPath "dnf" -}}
    {{- $distro_family = "fedora" -}}
  {{- end -}}
{{- end -}}

{{- $default_shell := "fish" -}}
{{- $compositor := "hyprland" -}}

{{- if not $skipPrompts -}}
  {{- $default_shell = promptChoice "Preferred shell" (list "fish" "zsh") -}}
  {{- $compositor = promptChoice "Preferred compositor" (list "hyprland" "niri") -}}
{{- end -}}

data:
  default_shell: {{ $default_shell | quote }}
  compositor: {{ $compositor | quote }}
  personal: {{ $personal }}
  distro_family: {{ $distro_family | lower | quote }}

scriptEnv:
  PERSONAL: "{{ if $personal }}1{{ else }}0{{ end }}"
  DISTRO_FAMILY: "{{ $distro_family | lower }}"
  DISTRO: "{{ .chezmoi.osRelease.id }}"
  DEFAULT_SHELL: "{{ $default_shell }}"
  COMPOSITOR: "{{ $compositor }}"


edit:
  command: "code"
  args: ["--wait"]

merge:
  command: "bash"
  args:
    - "-c"
    - "cp {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base && code --new-window --wait --merge {{ "{{" }} .Destination {{ "}}" }} {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base {{ "{{" }} .Source {{ "}}" }}"

diff:
  command: "delta"
  args:
    - "--paging=never"
    - "{{ "{{ .Destination }}" }}"
    - "{{ "{{ .Target }}" }}"
  pager: "delta"
  exclude:
    - "scripts"

github:
  refreshPeriod: 24h
