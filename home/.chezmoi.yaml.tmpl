{{- $personal := true -}}
{{- if eq (env "NOT_PERSONAL") "1" -}}
  {{- $personal = false -}}
{{- end -}}

{{- $osRelease := .chezmoi.osRelease -}}
{{- $distro_family := .chezmoi.os -}}
{{- if $osRelease -}}
  {{- $distro_family = default $distro_family (or (index $osRelease "idLike") (index $osRelease "id_like") (index $osRelease "id")) -}}
{{- end -}}

{{- $skipPrompts := eq (env "NOCONFIRM") "1" -}}

{{- $git_username := "" -}}
{{- $git_email := "" -}}
{{- $default_shell := "fish" -}}
{{- $compositor := "hyprland" -}}

{{- if not $personal -}}
  {{- if not $skipPrompts -}}
    {{- $git_username = promptString "Enter your Git username" -}}
    {{- $git_email = promptString "Enter your Git email" -}}
  {{- end -}}
{{- end -}}

{{- if not $skipPrompts -}}
  {{- $default_shell = promptChoice "Preferred shell" (list "fish" "zsh") -}}
  {{- $compositor = promptChoice "Preferred compositor" (list "hyprland" "niri") -}}
{{- end -}}

data:
  git_username: {{ $git_username | quote }}
  git_email: {{ $git_email | quote }}
  default_shell: {{ $default_shell | quote }}
  compositor: {{ $compositor | quote }}
  personal: {{ $personal }}
  distro_family: {{ $distro_family | lower | quote }}

scriptEnv:
  DISTRO_FAMILY: {{ $distro_family | lower | quote }}
  PERSONAL: {{ if $personal }}"1"{{ else }}"0"{{ end }}
  DEFAULT_SHELL: {{ $default_shell | quote }}
  COMPOSITOR: {{ $compositor | quote }}

edit:
  command: "code"
  args: ["--wait"]

merge:
  command: "bash"
  args:
    - "-c"
    - "cp {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base && code --new-window --wait --merge {{ "{{" }} .Destination {{ "}}" }} {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base {{ "{{" }} .Source {{ "}}" }}"

diff:
  command: "delta"
  args:
    - "--paging=never"
    - "{{ "{{ .Destination }}" }}"
    - "{{ "{{ .Target }}" }}"
  pager: "delta"
  exclude:
    - "scripts"

github:
  refreshPeriod: 24h
