#!/usr/bin/env bash

switch="$1"

TERMINAL="xdg-terminal-exec"
UPDATE_CMD="update"

# Pick shell: prefer fish > zsh > bash
if command -v fish >/dev/null 2>&1; then
  SHELL_CMD=("$(command -v fish)" -ic)
elif command -v zsh >/dev/null 2>&1; then
  SHELL_CMD=("$(command -v zsh)" -ic)
else
  SHELL_CMD=("$(command -v bash)" -ic)
fi

# Detect compositor
if [[ $XDG_CURRENT_DESKTOP == "Hyprland" ]]; then
  run_terminal() {
    hyprctl dispatch exec "[float; size 80% 80%; center 1] $TERMINAL $*"
  }
elif [[ $XDG_CURRENT_DESKTOP == "niri" ]]; then
  run_terminal() {
    "$TERMINAL" --app-id=FloatingTerm "$@"
  }
else
  echo "Unsupported compositor: $XDG_CURRENT_DESKTOP" >&2
  exit 1
fi

case "$switch" in
yazi)

  run_terminal yazi
  ;;
terminal)
  run_terminal
  ;;
update)
  run_terminal "${SHELL_CMD[@]}" "$UPDATE_CMD"
  ;;
*)
  echo "Usage: $0 {yazi|terminal|update}"
  exit 1
  ;;
esac
